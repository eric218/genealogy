package com.dct.swocean.controller;

import javax.servlet.http.HttpServletRequest;

import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.alibaba.fastjson.JSONObject;
import com.dct.swocean.util.RedisUtil;
/**
 * 
 * @author 周平，王少刚
 *
 */
@RestController
@RequestMapping("/redis")
public class RedisController {

	// 获取指定值的缓存
	@RequestMapping("/getByKey/{json}")
	public String getByKey(HttpServletRequest request,
			@PathVariable("json") String json) {
		JSONObject jsonObj = JSONObject.parseObject(json);
		String key = jsonObj.getString("key");
		Integer seconds = jsonObj.getInteger("seconds");
		if (seconds == null) {
			return RedisUtil.get(key);
		}
		return RedisUtil.get(key, seconds);
	}

	// 设置键值对
	@RequestMapping("/setKeyValue/{json}")
	public boolean setKeyValue(HttpServletRequest request,
			@PathVariable("json") String json) {
		JSONObject jsonObj = JSONObject.parseObject(json);
		String key = jsonObj.getString("key");
		String value = jsonObj.getString("value");
		Integer seconds = jsonObj.getInteger("seconds");
		if (seconds == null) {
			return RedisUtil.set(key, value);
		}
		return RedisUtil.set(key, value, seconds);
	}

	// 删除指定值的缓存
	@RequestMapping("/delKey/{json}")
	public Long delKey(HttpServletRequest request,@PathVariable("json") String json) {
		JSONObject jsonObj = JSONObject.parseObject(json);
		if(jsonObj.getString("key") != null){
			return RedisUtil.delKey(jsonObj.getString("key"));
		}
		return RedisUtil.delKey(jsonObj.getString("hashName"),jsonObj.getString("hashKey"));
	}

	// 清空当前DB缓存
	@RequestMapping("/delOneDB/{json}")
	public String delOneDB(HttpServletRequest request,@PathVariable("json") String json) {
		return RedisUtil.delOneDB();
	}
	//清空所有DB缓存
	@RequestMapping("/delAllDB/{json}")
	public String delAllDB(HttpServletRequest request,@PathVariable("json") String json) {
		return RedisUtil.delAllDB();
	}
}
